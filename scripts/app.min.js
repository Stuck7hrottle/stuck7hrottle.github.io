!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.App=e()}}(function(){return function e(t,i,o){function s(r,a){if(!i[r]){if(!t[r]){var c="function"==typeof require&&require;if(!a&&c)return c(r,!0);if(n)return n(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var p=i[r]={exports:{}};t[r][0].call(p.exports,function(e){var i=t[r][1][e];return s(i?i:e)},p,p.exports,e,t,i,o)}return i[r].exports}for(var n="function"==typeof require&&require,r=0;r<o.length;r++)s(o[r]);return s}({1:[function(e,t,i){"use strict";var o=e("jquery");e("jquery-migrate"),e("foundation-sites");var s=e("lodash"),n=e("./gmaps.ts"),r=function(){function e(e,t){this.latLng=new google.maps.LatLng(e,t)}return e.prototype.toString=function(){return this.latLng.lat()+", "+this.latLng.lng()},e.prototype.getLatLng=function(){return this.latLng},e}();i.Location=r;var a=function(){function e(){}return e.getHiveRadius=function(e){return(e-1)*Math.sqrt(3)*this.scanRadius+this.scanRadius},e.getStepsToCoverRadius=function(e){return Math.ceil((e-this.scanRadius)/this.scanRadius/Math.sqrt(3)+1)},e.getBeehiveRadius=function(t,i){return Math.floor(3*(t-1)/2-.5)*(e.getHiveRadius(i)-e.hiveOverlap)+e.getHiveRadius(i)},e.getLeapsToCoverRadius=function(t,i){return Math.ceil(2*((t-e.getHiveRadius(i))/(e.getHiveRadius(i)-e.hiveOverlap)+.5)/3+1)},e.distanceBetweenHiveCenters=function(t){var i=(t-1)*(3*this.scanRadius/2)+e.locationAdjustment;return 2*i-e.hiveOverlap},e.scanRadius=450,e.locationAdjustment=Math.sqrt(3)*e.scanRadius/2,e.hiveOverlap=e.scanRadius/2-2*(e.scanRadius-e.locationAdjustment),e}();i.Util=a;var c=function(){function e(){new n.GMaps;o(document).foundation(),Foundation.Abide.defaults.validators.accountColumns=function(e,t,i){var n=o("#accounts").val();if(!t)return!0;if(t&&s.isEmpty(n))return!1;var r=Number(o("#accountColumns").val().split(",").length),a=n.split("\n"),c=s.some(a,function(e){var t=e.split(",").length;return r!==t});return!c},Foundation.Abide.defaults.validators.enoughAccounts=function(e,t,i){var n=Number(o("#workers").val())*Number(o("#hives").val()),r=o("#accounts").val();if(s.isEmpty(r))return!1;var a=r.split("\n").length;return a>=n}}return e}();i.App=c},{"./gmaps.ts":3,"foundation-sites":"foundation-sites",jquery:"jquery","jquery-migrate":"jquery-migrate",lodash:"lodash"}],2:[function(e,t,i){"use strict";var o=e("./app.ts"),s=e("./hive.ts"),n=e("knockout"),r=e("lodash"),a=function(){function e(e){var t=this;this.options=e,this.hives=n.observableArray([]),this.isEditingHives=!1,this.coveringRadius=o.Util.getBeehiveRadius(this.options.leaps,this.options.steps),this.activeHives=n.computed(function(){return t.getActiveHives()},this,{deferEvaluation:!0}),this.mapObject=new google.maps.Circle({radius:this.coveringRadius,fillColor:"#0000FF",fillOpacity:0,strokeWeight:1,clickable:!0,center:this.options.center.getLatLng(),editable:!0,draggable:!0,zIndex:3}),this.options.map.addMapObject(this.mapObject),this.generateHives(),this.toggleActive(),this.options.map.addListener(this.mapObject,"click",function(){return t.toggleActive()}),this.options.map.addListener(this.mapObject,"radius_changed",function(){t.coveringRadius=t.mapObject.getRadius();var e=o.Util.getLeapsToCoverRadius(t.coveringRadius,t.options.steps);t.options.leaps!==e&&(t.options.leaps=e,t.generateHives())}),this.options.map.addListener(this.mapObject,"center_changed",function(){var e=t.mapObject.getCenter();t.options.center=new o.Location(e.lat(),e.lng()),t.generateHives()})}return e.prototype.getHives=function(){return console.log("getting hives for "+this.options.center.toString()),this.hives()},e.prototype.reset=function(e){void 0===e&&(e=!1);for(var t=0;t<this.hives().length;t++)this.hives()[t].reset();this.hives([]),e&&(this.mapObject=this.options.map.removeMapObject(this.mapObject))},e.prototype.generateHives=function(){var e=this;this.reset();var t=[],i=o.Util.distanceBetweenHiveCenters(this.options.steps),n=function(n,r,a,c){void 0===a&&(a=i),void 0===c&&(c=!0);var l=google.maps.geometry.spherical.computeOffset(n,a,r);return c&&(l=google.maps.geometry.spherical.computeOffset(l,o.Util.locationAdjustment,r+90)),t.push(new s.Hive({center:new o.Location(l.lat(),l.lng()),steps:e.options.steps,map:e.options.map})),l},r=this.options.center.getLatLng();r=n(r,0,0,!1),this.lastHiveCenter=r;for(var a=2;a<=this.options.leaps;a++){r=n(this.lastHiveCenter,0,i),this.lastHiveCenter=r;for(var c=1;c<a;c++)r=n(r,120);for(var l=1;l<a;l++)r=n(r,180);for(var p=1;p<a;p++)r=n(r,240);for(var u=1;u<a;u++)r=n(r,300);for(var h=1;h<a;h++)r=n(r,0);for(var v=2;v<a;v++)r=n(r,60)}return this.hives(t),this.hives()},e.prototype.resize=function(e){this.options.steps=e,this.options.leaps=o.Util.getLeapsToCoverRadius(this.coveringRadius,this.options.steps),this.generateHives()},e.prototype.disableActive=function(){this.isActive=!1,this.isEditingHives&&this.editHives(),this.mapObject.set("fillOpacity",0)},e.prototype.toggleActive=function(e){void 0===e&&(e=!1),this.isActive=!this.isActive,this.mapObject.set("fillOpacity",this.isActive?.3:0),this.options.map.setActiveBeehive(this.isActive?this:null)},e.prototype.editHives=function(){this.isEditingHives=!this.isEditingHives;for(var e=0;e<this.hives().length;e++)this.isEditingHives?this.hives()[e].addListener():this.hives()[e].removeListener();this.mapObject.set("zIndex",this.isEditingHives?1:3),this.mapObject.set("fillOpacity",this.isEditingHives?0:.3)},e.prototype.getActiveHives=function(){return r.filter(this.hives(),function(e){return e.isActive()})},e}();i.Beehive=a},{"./app.ts":1,"./hive.ts":4,knockout:"knockout",lodash:"lodash"}],3:[function(e,t,i){"use strict";var o=e("../config.ts"),s=e("load-google-maps-api"),n=e("./app.ts"),r=e("./map.ts"),a=function(){function e(){var e=this;this.map=new r.Map,s.default({key:o.config.googleMapsKey,libraries:["places","geometry"]}).then(function(t){e.initMap()})}return e.prototype.getMap=function(){return this.map},e.prototype.initMap=function(){var e=this;this.gmap=new google.maps.Map(document.getElementById("map"),{zoom:o.config.zoom,center:new google.maps.LatLng(o.config.latitude,o.config.longitude),mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_RIGHT}});var t=document.getElementById("pac-input");document.getElementById("latlng").placeholder="'"+o.config.latitude+","+o.config.longitude+"'",this.gmap.controls[google.maps.ControlPosition.TOP_LEFT].push(document.getElementById("custom-map-controls")),this.gmap.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(document.getElementById("script-options"));var i=new google.maps.places.Autocomplete(t);i.bindTo("bounds",this.gmap),i.addListener("place_changed",function(){var t=i.getPlace();if(t.geometry){e.gmap.setCenter(t.geometry.location),e.gmap.setZoom(10);var o=document.getElementById("latlng");o.value=String(t.geometry.location.lat())+","+String(t.geometry.location.lng())}}),document.getElementById("submit").addEventListener("click",function(){e.geocoder=new google.maps.Geocoder;var t=document.getElementById("latlng");if(!t.value)return void window.alert("Please enter a valid location or coordinates to add a new hive.");var i=t.value.split(",",2),o={lat:parseFloat(i[0]),lng:parseFloat(i[1])};e.geocoder.geocode({location:o},function(t,s){var r=String(s);"OK"===r?t[1]?(e.gmap.setZoom(12),e.gmap.setCenter(o),e.map.addBeehive(new n.Location(parseFloat(i[0]),parseFloat(i[1])))):window.alert("No results found."):window.alert("Geocoder failed due to: "+s)})}),document.getElementById("legacy-checkbox").addEventListener("click",function(){var t=document.getElementById("legacy-label");t.classList.toggle("legacy-mode"),t.classList.contains("legacy-mode")?e.gmap.addListener("click",function(t){e.map.addBeehive(new n.Location(t.latLng.lat(),t.latLng.lng())),e.gmap.setCenter({lat:t.latLng.lat(),lng:t.latLng.lng()})}):google.maps.event.clearListeners(e.gmap,"click")}),google.maps.event.addListenerOnce(this.gmap,"idle",function(){e.map.initMap({gmap:e.gmap})})},e}();i.GMaps=a},{"../config.ts":7,"./app.ts":1,"./map.ts":5,"load-google-maps-api":"load-google-maps-api"}],4:[function(e,t,i){"use strict";var o=e("./app.ts"),s=e("knockout"),n=function(){function e(e){this.options=e,this.isActive=s.observable(!1);var t=this.options.center.getLatLng(),i=o.Util.getHiveRadius(this.options.steps),n=google.maps.geometry.spherical.computeOffset,r=[n(t,i,30),n(t,i,90),n(t,i,150),n(t,i,210),n(t,i,270),n(t,i,330)],a=new google.maps.Polygon({paths:r,fillOpacity:.3,strokeWeight:1,zIndex:2});this.mapObject=a,this.toggleActive(),this.options.map.addMapObject(a)}return Object.defineProperty(e.prototype,"steps",{get:function(){return this.options.steps},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.mapObject=this.options.map.removeMapObject(this.mapObject)},e.prototype.toggleActive=function(){this.isActive(!this.isActive()),this.mapObject.set("fillColor",this.isActive()?"#0F0":"#F00")},e.prototype.addListener=function(){var e=this;this.activeListener=google.maps.event.addListener(this.mapObject,"click",function(){return e.toggleActive()})},e.prototype.removeListener=function(){this.activeListener.remove()},e.prototype.getCenter=function(){return this.options.center},e}();i.Hive=n},{"./app.ts":1,knockout:"knockout"}],5:[function(e,t,i){"use strict";var o=e("../config.ts"),s=e("./beehive.ts"),n=e("jquery"),r=e("./viewModel.ts"),a=e("knockout"),c=e("lodash"),l=function(){function e(){var e=this;this.beehives=a.observableArray([]),this.activeBeehive=null,this.steps=o.config.steps,this.activeHives=a.computed(function(){return e.getActiveHives()})}return e.prototype.initMap=function(e){var t=this;this.options=e;var i=n("#beehive-control .slider").data("zfPlugin").options;i.end=o.config.maxSteps,i.initialStart=o.config.steps,n("#custom-map-controls").show(),Foundation.reInit(["slider"]),n("#beehive-control .slider").on("moved.zf.slider",function(e){return t.changeSteps(e)}),n("#remove").on("click",function(){return t.removeActiveHive()}),n("#edit-hives").on("click",function(){return t.editHives()}),n("#generate-ui-wrapper").on("open.zf.reveal",function(){c.forEach(n("input,select,textarea","#generate-ui"),function(e){return n("#generate-ui").foundation("validateInput",n(e))})});var s=new r.ViewModel({map:this});a.applyBindings(s,document.getElementsByTagName("body")[0])},e.prototype.addBeehive=function(e){var t=new s.Beehive({map:this,steps:this.steps,leaps:o.config.leaps,center:e});this.beehives.push(t),n("#script-options").show()},e.prototype.addMapObject=function(e){e.set("map",this.options.gmap)},e.prototype.removeMapObject=function(e){return e.set("map",null),e=null},e.prototype.addListener=function(e,t,i){google.maps.event.addListener(e,t,i)},e.prototype.changeSteps=function(e){this.steps=Number(n("#steps").val()),null!==this.activeBeehive&&this.activeBeehive.resize(this.steps)},e.prototype.removeActiveHive=function(){null!==this.activeBeehive&&(this.activeBeehive.reset(!0),this.beehives.splice(this.beehives.indexOf(this.activeBeehive),1),this.activeBeehive=null,n("#remove").hide(),0===this.beehives().length&&n("#script-options").hide())},e.prototype.setActiveBeehive=function(e){null!==this.activeBeehive&&this.activeBeehive.disableActive(),null!==e?(n("#remove").show(),n("#edit-hives").show()):(n("#remove").hide(),n("#edit-hives").hide()),this.activeBeehive=e},e.prototype.editHives=function(){this.activeBeehive.editHives()},e.prototype.getActiveHives=function(){return c.flatten(c.map(this.beehives(),function(e){return e.activeHives()}))},e}();i.Map=l},{"../config.ts":7,"./beehive.ts":2,"./viewModel.ts":6,jquery:"jquery",knockout:"knockout",lodash:"lodash"}],6:[function(e,t,i){"use strict";var o=e("../config.ts"),s=e("jquery"),n=e("knockout"),r=e("lodash"),a=function(){function e(e){var t=this;this.options=e,this.activeHives=n.computed(function(){return t.getActiveHives()}),this.rocketmapDirectory=n.observable(o.config.rocketmapDirectory),this.os=n.observable(o.config.os),this.os.subscribe(function(e){t.invalidFields([]),"windows"===t.os()?s("#rocketmap-directory").removeAttr("data-abide-ignore"):s("#rocketmap-directory").attr("data-abide-ignore",""),r.forEach(s("input,select,textarea","#generate-ui"),function(e){return s("#generate-ui").foundation("validateInput",s(e))})}),this.serverCheckbox=n.observable(s("#serverCheckbox").is(":checked")),this.serverNoPokemon=n.observable(s("#no-pokemon").is(":checked")),this.serverNoGyms=n.observable(s("#no-gyms").is(":checked")),this.serverNoPokestops=n.observable(s("#no-pokestops").is(":checked")),this.serverSearchControl=n.observable(s("#search-control").is(":checked")),this.serverNoFixedLocation=n.observable(s("#no-fixed-location").is(":checked")),this.serverOptions=n.computed(function(){return t.getServerOptions().toString()}),this.alarmCheckbox=n.observable(s("#alarmCheckbox").is(":checked")),this.alarmConfig=n.observable(s("#alarm-config").is(":checked")),this.alarmHost=n.observable(s("#alarm-host").is(":checked")),this.alarmPort=n.observable(s("#alarm-port").is(":checked")),this.alarmConfigValue=n.observable("custom-alarms.json"),this.alarmHostValue=n.observable("127.0.0.1"),this.alarmPortValue=n.observable(4e3),this.alarmOptions=n.computed(function(){return t.getAlarmOptions().toString()}),this.accountsPerHive=n.observable(0),this.accountDirectory=n.observable(o.config.accountDirectory),this.scriptDelay=n.observable(o.config.scriptDelay),this.webhookCheckbox=n.observable(s("#webhook-checkbox").is(":checked")),this.snCheckbox=n.observable(s("#sn-checkbox").is(":checked")),this.disableClean=n.observable(s("#disable-clean").is(":checked")),this.webhookValue=n.observable("http://127.0.0.1:4000"),this.snValue=n.observable("HIVE{index}"),this.workerNoPokemon=n.observable(s("#worker-no-pokemon").is(":checked")),this.workerNoGyms=n.observable(s("#worker-no-gyms").is(":checked")),this.workerNoPokestops=n.observable(s("#worker-no-pokestops").is(":checked")),this.workerOptions=n.computed(function(){return t.getWorkerOptions().toString()}),this.windowsTemplates=new l(o.config.windowsTemplates),this.linuxTemplates=new l(o.config.linuxTemplates),this.activeTemplates=n.computed(function(){return t.getActiveTemplates()}),this.generateScriptPreview=n.computed(function(){return t.generateScriptOutput(!0).replace(/\n/g,"<br />")}),this.invalidFields=n.observableArray([]),this.isValid=n.computed(function(){return 0===t.invalidFields().length}),this.isValid.subscribe(function(e){e?s("#download").show():s("#download").hide()}),this.isValid&&s("#download").show(),s(document).on("valid.zf.abide invalid.zf.abide",function(e){return t.handleFormInputValidation(e)}),s(document).on("formvalid.zf.abide forminvalid.zf.abide",function(e){return t.handleFormValidation(e)})}return e.prototype.handleFormInputValidation=function(e){var t=s(e.target).attr("name"),i=this.invalidFields.indexOf(t);"valid"===e.type?i>=0&&this.invalidFields.splice(i,1):i<0&&this.invalidFields.push(t)},e.prototype.handleFormValidation=function(e){"valid"===e.type&&this.invalidFields([])},e.prototype.getActiveHives=function(){return this.options.map.activeHives()},e.prototype.getActiveTemplates=function(){return"windows"===this.os()?this.windowsTemplates:this.linuxTemplates},e.prototype.getServerOptions=function(){var e="";if(this.serverCheckbox){var t=this.serverNoPokemon()?"-np ":"",i=this.serverNoGyms()?"-ng ":"",o=this.serverNoPokestops()?"-nk ":"",s=this.serverSearchControl()?"-sc ":"",n=this.serverNoFixedLocation()?"-nfl":"";e=t+i+o+s+n}else e="";return e},e.prototype.getAlarmOptions=function(){var e="";if(this.alarmCheckbox){var t=this.alarmConfig()&&this.alarmConfigValue()?"-a "+this.alarmConfigValue().toString():"",i=this.alarmHost()&&this.alarmHostValue()?" -H "+this.alarmHostValue().toString():"",o=this.alarmPort()&&this.alarmPortValue()?" -P "+this.alarmPortValue().toString():"";e=t+i+o}else e="";return e},e.prototype.getWorkerOptions=function(){var e="",t=this.snCheckbox()&&this.snValue()?"-sn "+this.snValue().toString():"",i=this.webhookCheckbox()&&this.webhookValue()?'-wh "'+this.webhookValue().toString()+'"':"",o=this.disableClean()?" --disable-clean ":"",s=this.workerNoPokemon()?" -np ":"",n=this.workerNoGyms()?" -ng ":"",r=this.workerNoPokestops()?" -nk ":"";return e=t+o+i+s+n+r},e.prototype.generateScriptOutput=function(e){void 0===e&&(e=!0);var t=this.activeTemplates(),i=this.activeHives();if(i.length<=0)return"";for(var o=this.serverOptions(),s=this.alarmOptions(),n=this.workerOptions(),r=t.setup.value()+"\n",a=this.serverCheckbox()===!1?"":this.replaceVariables(t.server.value(),{"rocketmap-directory":this.rocketmapDirectory(),location:i[0].getCenter().toString(),"server-options":o})+"\n",c=this.alarmCheckbox()===!1?"":this.replaceVariables(t.alarm.value(),{"alarm-options":s})+"\n",l="",p=0;p<(e?1:i.length);p++){var u=p<i.length-1?this.scriptDelay():0;l+=this.replaceVariables(t.worker.value(),{"rocketmap-directory":this.rocketmapDirectory(),"account-directory":this.accountDirectory(),location:i[p].getCenter().toString(),steps:i[p].steps,workers:this.accountsPerHive(),"worker-options":n,index:p+1})+"\n",u>0&&(l+=this.replaceVariables(t.delay.value(),{"script-delay":u})+"\n")}return r+a+c+l},e.prototype.replaceVariables=function(e,t){return r.forOwn(t,function(t,i){return e=e.replace(new RegExp("{"+i+"}","g"),t)}),e},e.prototype.downloadFile=function(){var e=this.generateScriptOutput(!1);this.downloadScript(e,this.activeTemplates().filename.value())},e.prototype.updateAPH=function(){s("#workers").trigger("change")},e.prototype.coordsFile=function(){var e=r.join(r.map(this.activeHives(),function(e){return e.getCenter().toString()}),"\n");this.downloadScript(e,"coords.txt")},e.prototype.downloadScript=function(e,t){var i=new Blob([e],{type:"text/plain"}),o=window.URL.createObjectURL(i),n=s("<a>",{style:"display: none;",download:t,href:o});n.on("click",function(){setTimeout(function(){window.URL.revokeObjectURL(o),n.remove()},50)}),s("#generate-ui").append(n),n[0].dispatchEvent(new MouseEvent("click"))},e}();i.ViewModel=a;var c=function(){function e(e){var t=this;this.defaultValue=e,this.value=n.observable(e),this.isDirty=n.observable(!1),this.value.subscribe(function(e){return t.isDirty(!0)})}return e}();i.Template=c;var l=function(){function e(e){this.setup=new c(e.setup),this.alarm=new c(e.alarm),this.server=new c(e.server),this.worker=new c(e.worker),this.delay=new c(e.delay),this.filename=new c(e.filename)}return e}();i.Templates=l},{"../config.ts":7,jquery:"jquery",knockout:"knockout",lodash:"lodash"}],7:[function(e,t,i){"use strict";var o=function(){function e(){}return e.googleMapsKey="AIzaSyC9x0Xr9R8LYUSVWuIwuFdMW6h6Siz2O90",e.latitude=37.09024,e.longitude=-95.712891,e.zoom=5,e.leaps=2,e.steps=6,e.maxSteps=100,e.os="windows",e.scriptDelay=300,e.rocketmapDirectory="D:\\RocketMap",e.accountDirectory="workers/",e.windowsTemplates={setup:"taskkill /IM python.exe /F",alarm:'Start "Alarm" /d {rocketmap-directory} /MIN python.exe Tools/PokeAlarm/start_pokealarm.py {alarm-options}',server:'Start "Server" /d {rocketmap-directory} /MIN python.exe runserver.py -os -l "{location}" {server-options}',worker:'Start "Worker{index}" /d {rocketmap-directory} /MIN python.exe runserver.py -ns -ac {account-directory}hive{index}.csv -l "{location}" {worker-options} -st {steps} -w {workers}',delay:"ping 127.0.0.1 -n {script-delay} > null",filename:"start-scan.bat"},e.linuxTemplates={setup:"#!/usr/bin/env bash",alarm:"screen -d -m -S ALARM python Tools/PokeAlarm/start_pokealarm.py {alarm-options}",server:"screen -d -m -S MAP python runserver.py -os -l '{location}' {server-options}",worker:"screen -d -m -S HIVE{index} python runserver.py -ns -ac {account-directory}hive{index}.csv -l '{location}' {worker-options} -st {steps} -w {workers}",delay:"sleep {script-delay}",filename:"start-scan.sh"},e}();i.config=o},{}]},{},[1])(1)});
//# sourceMappingURL=app.min.js.map
