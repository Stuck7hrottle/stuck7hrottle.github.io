!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.App=e()}}(function(){return function e(t,i,n){function o(a,r){if(!i[a]){if(!t[a]){var p="function"==typeof require&&require;if(!r&&p)return p(a,!0);if(s)return s(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[a]={exports:{}};t[a][0].call(c.exports,function(e){var i=t[a][1][e];return o(i?i:e)},c,c.exports,e,t,i,n)}return i[a].exports}for(var s="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,i){"use strict";var n=e("jquery");e("jquery-migrate"),e("foundation-sites");var o=e("lodash"),s=e("./gmaps.ts"),a=function(){function e(e,t){this.latLng=new google.maps.LatLng(e,t)}return e.prototype.toString=function(){return this.latLng.lat()+", "+this.latLng.lng()},e.prototype.getLatLng=function(){return this.latLng},e}();i.Location=a;var r=function(){function e(){}return e.getHiveRadius=function(e){return(e-1)*Math.sqrt(3)*this.scanRadius+this.scanRadius},e.getStepsToCoverRadius=function(e){return Math.ceil((e-this.scanRadius)/this.scanRadius/Math.sqrt(3)+1)},e.getBeehiveRadius=function(t,i){return Math.floor(3*(t-1)/2-.5)*(e.getHiveRadius(i)-e.hiveOverlap)+e.getHiveRadius(i)},e.getLeapsToCoverRadius=function(t,i){return Math.ceil(2*((t-e.getHiveRadius(i))/(e.getHiveRadius(i)-e.hiveOverlap)+.5)/3+1)},e.distanceBetweenHiveCenters=function(t){var i=(t-1)*(3*this.scanRadius/2)+e.locationAdjustment;return 2*i-e.hiveOverlap},e.scanRadius=70,e.locationAdjustment=Math.sqrt(3)*e.scanRadius/2,e.hiveOverlap=e.scanRadius/2-2*(e.scanRadius-e.locationAdjustment),e}();i.Util=r;var p=function(){function e(){new s.GMaps;n(document).foundation(),Foundation.Abide.defaults.validators.accountColumns=function(e,t,i){var s=n("#accounts").val();if(!t)return!0;if(t&&o.isEmpty(s))return!1;var a=Number(n("#accountColumns").val().split(",").length),r=s.split("\n"),p=o.some(r,function(e){var t=e.split(",").length;return a!==t});return!p},Foundation.Abide.defaults.validators.enoughAccounts=function(e,t,i){var s=Number(n("#workers").val())*Number(n("#hives").val()),a=n("#accounts").val();if(o.isEmpty(a))return!1;var r=a.split("\n").length;return r>=s}}return e}();i.App=p},{"./gmaps.ts":3,"foundation-sites":"foundation-sites",jquery:"jquery","jquery-migrate":"jquery-migrate",lodash:"lodash"}],2:[function(e,t,i){"use strict";var n=e("./app.ts"),o=e("./hive.ts"),s=e("knockout"),a=e("lodash"),r=function(){function e(e){var t=this;this.options=e,this.hives=s.observableArray([]),this.isEditingHives=!1,this.coveringRadius=n.Util.getBeehiveRadius(this.options.leaps,this.options.steps),this.activeHives=s.computed(function(){return t.getActiveHives()},this,{deferEvaluation:!0}),this.mapObject=new google.maps.Circle({radius:this.coveringRadius,fillColor:"#0000FF",fillOpacity:0,strokeWeight:1,clickable:!0,center:this.options.center.getLatLng(),editable:!0,draggable:!0,zIndex:3}),this.options.map.addMapObject(this.mapObject),this.generateHives(),this.toggleActive(),this.options.map.addListener(this.mapObject,"click",function(){return t.toggleActive()}),this.options.map.addListener(this.mapObject,"radius_changed",function(){t.coveringRadius=t.mapObject.getRadius();var e=n.Util.getLeapsToCoverRadius(t.coveringRadius,t.options.steps);t.options.leaps!==e&&(t.options.leaps=e,t.generateHives())}),this.options.map.addListener(this.mapObject,"center_changed",function(){var e=t.mapObject.getCenter();t.options.center=new n.Location(e.lat(),e.lng()),t.generateHives()})}return e.prototype.getHives=function(){return console.log("getting hives for "+this.options.center.toString()),this.hives()},e.prototype.reset=function(e){void 0===e&&(e=!1);for(var t=0;t<this.hives().length;t++)this.hives()[t].reset();this.hives([]),e&&(this.mapObject=this.options.map.removeMapObject(this.mapObject))},e.prototype.generateHives=function(){var e=this;this.reset();var t=[],i=n.Util.distanceBetweenHiveCenters(this.options.steps),s=function(s,a,r,p){void 0===r&&(r=i),void 0===p&&(p=!0);var u=google.maps.geometry.spherical.computeOffset(s,r,a);return p&&(u=google.maps.geometry.spherical.computeOffset(u,n.Util.locationAdjustment,a+90)),t.push(new o.Hive({center:new n.Location(u.lat(),u.lng()),steps:e.options.steps,map:e.options.map})),u},a=this.options.center.getLatLng();a=s(a,0,0,!1),this.lastHiveCenter=a;for(var r=2;r<=this.options.leaps;r++){a=s(this.lastHiveCenter,0,i),this.lastHiveCenter=a;for(var p=1;p<r;p++)a=s(a,120);for(var u=1;u<r;u++)a=s(a,180);for(var c=1;c<r;c++)a=s(a,240);for(var l=1;l<r;l++)a=s(a,300);for(var h=1;h<r;h++)a=s(a,0);for(var v=2;v<r;v++)a=s(a,60)}return this.hives(t),this.hives()},e.prototype.resize=function(e){this.options.steps=e,this.options.leaps=n.Util.getLeapsToCoverRadius(this.coveringRadius,this.options.steps),this.generateHives()},e.prototype.disableActive=function(){this.isActive=!1,this.isEditingHives&&this.editHives(),this.mapObject.set("fillOpacity",0)},e.prototype.toggleActive=function(e){void 0===e&&(e=!1),this.isActive=!this.isActive,this.mapObject.set("fillOpacity",this.isActive?.3:0),this.options.map.setActiveBeehive(this.isActive?this:null)},e.prototype.editHives=function(){this.isEditingHives=!this.isEditingHives;for(var e=0;e<this.hives().length;e++)this.isEditingHives?this.hives()[e].addListener():this.hives()[e].removeListener();this.mapObject.set("zIndex",this.isEditingHives?1:3),this.mapObject.set("fillOpacity",this.isEditingHives?0:.3)},e.prototype.getActiveHives=function(){return a.filter(this.hives(),function(e){return e.isActive()})},e}();i.Beehive=r},{"./app.ts":1,"./hive.ts":4,knockout:"knockout",lodash:"lodash"}],3:[function(e,t,i){"use strict";var n=e("../config.ts"),o=e("load-google-maps-api"),s=e("./app.ts"),a=e("./map.ts"),r=function(){function e(){var e=this;this.map=new a.Map,o.default({key:n.config.googleMapsKey,libraries:["places","geometry"]}).then(function(t){e.initMap()})}return e.prototype.getMap=function(){return this.map},e.prototype.initMap=function(){var e=this;this.gmap=new google.maps.Map(document.getElementById("map"),{zoom:n.config.zoom,center:new google.maps.LatLng(n.config.latitude,n.config.longitude),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1});var t=document.getElementById("pac-input");this.gmap.controls[google.maps.ControlPosition.TOP_CENTER].push(document.getElementById("custom-map-controls")),this.gmap.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(document.getElementById("generate-trigger")),this.gmap.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(document.getElementById("github-buttons"));var i=new google.maps.places.Autocomplete(t);i.bindTo("bounds",this.gmap),i.addListener("place_changed",function(){var t=i.getPlace();t.geometry&&(e.gmap.setCenter(t.geometry.location),e.gmap.setZoom(n.config.zoom))}),this.gmap.addListener("click",function(t){e.map.addBeehive(new s.Location(t.latLng.lat(),t.latLng.lng()))}),google.maps.event.addListenerOnce(this.gmap,"idle",function(){e.map.initMap({gmap:e.gmap})})},e}();i.GMaps=r},{"../config.ts":7,"./app.ts":1,"./map.ts":5,"load-google-maps-api":"load-google-maps-api"}],4:[function(e,t,i){"use strict";var n=e("./app.ts"),o=e("knockout"),s=function(){function e(e){this.options=e,this.isActive=o.observable(!1);var t=this.options.center.getLatLng(),i=n.Util.getHiveRadius(this.options.steps),s=google.maps.geometry.spherical.computeOffset,a=[s(t,i,30),s(t,i,90),s(t,i,150),s(t,i,210),s(t,i,270),s(t,i,330)],r=new google.maps.Polygon({paths:a,fillOpacity:.3,strokeWeight:1,zIndex:2});this.mapObject=r,this.toggleActive(),this.options.map.addMapObject(r)}return Object.defineProperty(e.prototype,"steps",{get:function(){return this.options.steps},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.mapObject=this.options.map.removeMapObject(this.mapObject)},e.prototype.toggleActive=function(){this.isActive(!this.isActive()),this.mapObject.set("fillColor",this.isActive()?"#0F0":"#F00")},e.prototype.addListener=function(){var e=this;this.activeListener=google.maps.event.addListener(this.mapObject,"click",function(){return e.toggleActive()})},e.prototype.removeListener=function(){this.activeListener.remove()},e.prototype.getCenter=function(){return this.options.center},e}();i.Hive=s},{"./app.ts":1,knockout:"knockout"}],5:[function(e,t,i){"use strict";var n=e("../config.ts"),o=e("./beehive.ts"),s=e("jquery"),a=e("./viewModel.ts"),r=e("knockout"),p=e("lodash"),u=function(){function e(){var e=this;this.beehives=r.observableArray([]),this.activeBeehive=null,this.steps=n.config.steps,this.activeHives=r.computed(function(){return e.getActiveHives()})}return e.prototype.initMap=function(e){var t=this;this.options=e;var i=s("#beehive-control .slider").data("zfPlugin").options;i.end=n.config.maxSteps,i.initialStart=n.config.steps,s("#custom-map-controls").show(),s("#github-buttons").show(),Foundation.reInit(["slider"]),s("#beehive-control .slider").on("moved.zf.slider",function(e){return t.changeSteps(e)}),s("#remove").on("click",function(){return t.removeActiveHive()}),s("#edit-hives").on("click",function(){return t.editHives()}),s("#generate-ui-wrapper").on("open.zf.reveal",function(){p.forEach(s("input,select,textarea","#generate-ui"),function(e){return s("#generate-ui").foundation("validateInput",s(e))})});var o=new a.ViewModel({map:this});r.applyBindings(o,document.getElementsByTagName("body")[0])},e.prototype.addBeehive=function(e){var t=new o.Beehive({map:this,steps:this.steps,leaps:n.config.leaps,center:e});this.beehives.push(t),s("#generate-trigger").show()},e.prototype.addMapObject=function(e){e.set("map",this.options.gmap)},e.prototype.removeMapObject=function(e){return e.set("map",null),e=null},e.prototype.addListener=function(e,t,i){google.maps.event.addListener(e,t,i)},e.prototype.changeSteps=function(e){this.steps=Number(s("#steps").val()),null!==this.activeBeehive&&this.activeBeehive.resize(this.steps)},e.prototype.removeActiveHive=function(){null!==this.activeBeehive&&(this.activeBeehive.reset(!0),this.beehives.splice(this.beehives.indexOf(this.activeBeehive),1),this.activeBeehive=null,s("#remove").hide(),0===this.beehives().length&&s("#generate-trigger").hide())},e.prototype.setActiveBeehive=function(e){null!==this.activeBeehive&&this.activeBeehive.disableActive(),null!==e?(s("#remove").show(),s("#edit-hives").show()):(s("#remove").hide(),s("#edit-hives").hide()),this.activeBeehive=e},e.prototype.editHives=function(){this.activeBeehive.editHives()},e.prototype.getActiveHives=function(){return p.flatten(p.map(this.beehives(),function(e){return e.activeHives()}))},e}();i.Map=u},{"../config.ts":7,"./beehive.ts":2,"./viewModel.ts":6,jquery:"jquery",knockout:"knockout",lodash:"lodash"}],6:[function(e,t,i){"use strict";var n=e("../config.ts"),o=e("jquery"),s=e("knockout"),a=e("lodash"),r=function(){function e(e){var t=this;this.options=e,this.activeHives=s.computed(function(){return t.getActiveHives()}),this.pogomapDirectory=s.observable(""),this.os=s.observable(n.config.os),this.os.subscribe(function(e){t.invalidFields([]),"windows"===t.os()?o("#pogomap-directory").removeAttr("data-abide-ignore"):o("#pogomap-directory").attr("data-abide-ignore",""),a.forEach(o("input,select,textarea","#generate-ui"),function(e){return o("#generate-ui").foundation("validateInput",o(e))})}),this.accountsPerHive=s.observable(n.config.workers),this.accountColumns=s.observable(n.config.accountColumns),this.accountColumns.subscribe(function(e){return o("#generate-ui").foundation("validateInput",o("#accounts"))}),this.accounts=s.observable(""),this.windowsTemplates=new u(n.config.windowsTemplates),this.linuxTemplates=new u(n.config.linuxTemplates),this.activeTemplates=s.computed(function(){return t.getActiveTemplates()}),this.generateScriptPreview=s.computed(function(){return t.generateScriptOutput(!0).replace(/\n/g,"<br />")}),this.invalidFields=s.observableArray([]),this.isValid=s.computed(function(){return 0===t.invalidFields().length}),this.isValid.subscribe(function(e){e?o("#download").show():o("#download").hide()}),o(document).on("valid.zf.abide invalid.zf.abide",function(e){return t.handleFormInputValidation(e)}),o(document).on("formvalid.zf.abide forminvalid.zf.abide",function(e){return t.handleFormValidation(e)})}return e.prototype.handleFormInputValidation=function(e){var t=o(e.target).attr("name"),i=this.invalidFields.indexOf(t);"valid"===e.type?i>=0&&this.invalidFields.splice(i,1):i<0&&this.invalidFields.push(t)},e.prototype.handleFormValidation=function(e){"valid"===e.type&&this.invalidFields([])},e.prototype.getActiveHives=function(){return this.options.map.activeHives()},e.prototype.getActiveTemplates=function(){return"windows"===this.os()?this.windowsTemplates:this.linuxTemplates},e.prototype.generateScriptOutput=function(e){void 0===e&&(e=!0);var t=this.activeTemplates(),i=this.activeHives(),n=this.accounts().split("\n");if(i.length<=0)return"";for(var o="\n"+t.setup.value()+"\n"+this.replaceVariables(t.server.value(),{"pogomap-directory":this.pogomapDirectory(),location:i[0].getCenter().toString()})+"\n"+t.delay.value()+"\n        ",s="",r=0,p=a.map(this.accountColumns().split(","),function(e){return a.trim(e)}),u=0;u<(e?1:i.length);u++){for(var c=[],l=0;l<this.accountsPerHive();l++){var h={};if(n.length>r)for(var v=a.map(n[r].split(","),function(e){return a.trim(e)}),d=0;d<p.length;d++)h[p[d]]=v[d];r++,c.push(this.replaceVariables(t.auth.value(),h))}s+="\n"+this.replaceVariables(t.worker.value(),{"pogomap-directory":this.pogomapDirectory(),index:u+1,location:i[u].getCenter().toString(),steps:i[u].steps,"auth-template":a.join(c," ")})+"\n"+t.delay.value()+"\n            "}return o+s},e.prototype.replaceVariables=function(e,t){return a.forOwn(t,function(t,i){return e=e.replace(new RegExp("{"+i+"}","g"),t)}),e},e.prototype.downloadFile=function(){var e=this.generateScriptOutput(!1);this.downloadScript(e,this.activeTemplates().filename.value())},e.prototype.coordsFile=function(){var e=a.join(a.map(this.activeHives(),function(e){return e.getCenter().toString()}),"\n");this.downloadScript(e,"coords.txt")},e.prototype.downloadScript=function(e,t){var i=new Blob([e],{type:"text/plain"}),n=window.URL.createObjectURL(i),s=o("<a>",{style:"display: none;",download:t,href:n});s.on("click",function(){setTimeout(function(){window.URL.revokeObjectURL(n),s.remove()},50)}),o("#generate-ui").append(s),s[0].dispatchEvent(new MouseEvent("click"))},e}();i.ViewModel=r;var p=function(){function e(e){var t=this;this.defaultValue=e,this.value=s.observable(e),this.isDirty=s.observable(!1),this.value.subscribe(function(e){return t.isDirty(!0)})}return e}();i.Template=p;var u=function(){function e(e){this.setup=new p(e.setup),this.server=new p(e.server),this.worker=new p(e.worker),this.auth=new p(e.auth),this.delay=new p(e.delay),this.filename=new p(e.filename)}return e}();i.Templates=u},{"../config.ts":7,jquery:"jquery",knockout:"knockout",lodash:"lodash"}],7:[function(e,t,i){"use strict";var n=function(){function e(){}return e.googleMapsKey="AIzaSyD-e8302g9ooyV7-hl4eWA3tKtqZJBImGg",e.latitude=40.8258,e.longitude=-96.6852,e.zoom=12,e.leaps=4,e.steps=10,e.maxSteps=75,e.os="windows",e.workers=4,e.accountColumns="username, password",e.windowsTemplates={setup:"taskkill /IM python.exe /F",server:'Start "Server" /d {pogomap-directory} /MIN python.exe runserver.py -os -l "{location}"',worker:'Start "Worker{index}" /d {pogomap-directory} /MIN python.exe runserver.py -ns -l "{location}" -st {steps} {auth-template}',auth:'-u {username} -p "{password}"',delay:"ping 127.0.0.1 -n 6 > null",filename:"launch.bat"},e.linuxTemplates={setup:"#!/usr/bin/env bash",server:"nohup python runserver.py -os -l '{location}' &",worker:"nohup python runserver.py -ns -l '{location}' -st {steps} {auth-template} &",auth:"-u {username} -p '{password}'",delay:"sleep 0.5;",filename:"launch.sh"},e}();i.config=n},{}]},{},[1])(1)});
//# sourceMappingURL=app.min.js.map
